/*! snake 2015-11-15 */
function initGrid(){$("#graph").html(""),graph=d3.select("#graph").append("svg").attr("width",graph_width).attr("height",graph_height);for(var a=0;graph_width>=a;a+=min_size)graph.append("line").attr("x1",a).attr("y1",0).attr("x2",a).attr("y2",0+graph_height).attr("style","stroke:rgb(199,199,199);stroke-width:1");for(var b=0;graph_height>=b;b+=min_size)graph.append("line").attr("x1",0).attr("y1",b).attr("x2",0+graph_width).attr("y2",b).attr("style","stroke:rgb(199,199,199);stroke-width:1")}function initSnake(){snake=new Array(2),snake[0]=new Array,snake[1]=new Array,snake[0][0]=graph_width/2,snake[1][0]=graph_height/2,square_num+=1}function existInSnake(a,b){for(var c=0;square_num>c;c++)if(snake[0][c]==x&&snake[1][c]==y)return!0;return!1}function addSnakeFood(){do x=parseInt(Math.random()*graph_width/min_size)*min_size,y=parseInt(Math.random()*graph_height/min_size)*min_size;while(existInSnake(food_x,food_y));food_x=x,food_y=y}function checkEating(){switch(dir){case 0:if(snake[0][0]==food_x&&snake[1][0]-10==food_y)return!0;break;case 1:if(snake[0][0]+10==food_x&&snake[1][0]==food_y)return!0;break;case 2:if(snake[0][0]==food_x&&snake[1][0]+10==food_y)return!0;break;case 3:if(snake[0][0]-10==food_x&&snake[1][0]==food_y)return!0}return!1}function moveSnake(){if(graph.selectAll("rect").remove(),snake[0][0]<0||snake[0][0]>=graph_width||snake[1][0]<0||snake[1][0]>=graph_height)return clearInterval(timerMove),timerMove=null,alert("恭喜您, 你一共吃了 "+(square_num-1)+" 个食物."),document.title="我用贪吃蛇吃了"+(square_num-1)+"个食物",void(square_num=0);if(checkEating()){for(var a=square_num;a>=1;a--)snake[0][a]=snake[0][a-1],snake[1][a]=snake[1][a-1];snake[0][0]=food_x,snake[1][0]=food_y,square_num+=1,addSnakeFood()}else{for(var a=square_num-1;a>0;a--)snake[0][a]=snake[0][a-1],snake[1][a]=snake[1][a-1];switch(dir){case 0:snake[1][0]=snake[1][0]-10;break;case 1:snake[0][0]=snake[0][0]+10;break;case 2:snake[1][0]=snake[1][0]+10;break;case 3:snake[0][0]=snake[0][0]-10}}paintSnake()}function paintSnake(){graph.append("rect").attr("width",min_size).attr("height",min_size).attr("x",snake[0][0]).attr("y",snake[1][0]).attr("style","fill:rgb(0,0,255);opacity:0.8");for(var a=1;square_num>a;a++)graph.append("rect").attr("width",min_size).attr("height",min_size).attr("x",snake[0][a]).attr("y",snake[1][a]).attr("style","fill:rgb(199,199,199);opacity:0.8");graph.append("rect").attr("width",min_size).attr("height",min_size).attr("x",food_x).attr("y",food_y).attr("style","fill:rgb(255,0,0);opacity:0.8")}function startSnake(){null==timerMove&&(timerMove=setInterval(moveSnake,snake_speed)),0==square_num&&(initSnake(),addSnakeFood())}function pauseSnake(){null!=timerMove&&(clearInterval(timerMove),timerMove=null)}var graph=null,graph_width=10*parseInt($(window).width()/10),graph_height=20*parseInt($(window).height()/30);$("#graph").css("width",graph_width+"px"),$("#graph").css("height",graph_height+"px"),$("#graph").css("margin","0 auto");var min_size=10,snake=null,snake_speed=100,square_num=0,dir=0,food_x=0,food_y=0,timerMove=null;$(window).load(function(){initGrid(),initSnake(),addSnakeFood(),timerMove=setInterval(moveSnake,snake_speed),$("body").on("keydown",function(a){switch(a.which){case"w".charCodeAt(0):case"W".charCodeAt(0):case 38:dir=0;break;case"d".charCodeAt(0):case"D".charCodeAt(0):case 39:dir=1;break;case"s".charCodeAt(0):case"S".charCodeAt(0):case 40:dir=2;break;case"a".charCodeAt(0):case"A".charCodeAt(0):case 37:dir=3}}),$("body").swipe({swipe:function(a,b,c,d,e){switch(b){case"up":dir=0;break;case"right":dir=1;break;case"down":dir=2;break;case"left":dir=3}}})});